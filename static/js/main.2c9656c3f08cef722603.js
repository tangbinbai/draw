(()=>{"use strict";var t,e={329:(t,e,i)=>{const s=class{constructor(){this.events={}}register(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}removeEvent(t,e){if(void 0===this.events&&(this.events={}),this.events[t]instanceof Array){const i=this.events[t];for(let t=0,s=i.length;t<s;t++)if(i[t]===e){i.splice(t,1);break}}}trigger(t,e){if(!this.events[t])return;const i=this.events[t];for(let t=0,s=i.length;t<s;t++)i[t].call(this,e)}},n=t=>{const e=(t=>{const{toString:e}=Object.prototype;return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[e.call(t)]})(t);let i,s,o;if("array"===e)i=[];else{if("object"!==e)return t;i={}}if("array"===e){for(s=0,o=t.length;s<o;s++)i.push(n(t[s]));return i}if("object"===e){for(s in t)i[s]=n(t[s]);return i}},o=t=>`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`,r=new Map,h=(t,e)=>{if(r.has(t))return e&&e(r.get(t)),r.get(t);const i=new Image;return i.crossOrigin="anonymous",i.onload=()=>{r.set(t,i),e&&e(i)},i.onerror=()=>{e&&e(null)},i.src=t,i},a=(t,e)=>{t.beginPath(),t.moveTo(e.drawPoints[0],e.drawPoints[1]);for(let i=2;i<e.drawPoints.length;i+=2)t.lineTo(e.drawPoints[i],e.drawPoints[i+1]);t.closePath(),t.fill(),e.lineWidth&&t.stroke()},d=(t,e)=>{e.visible&&(l(t,e),e.children.length>0&&(e.children.sort(((t,e)=>t.zIndex-e.zIndex)),e.children.forEach((e=>{d(t,e)}))))},l=(t,e)=>{var i;c(t,e),t.save(),((t,e)=>{const i=`rgba(\n    ${e.fillStyle.join(",")}\n  )`,s=`rgba(\n    ${e.strokeStyle.join(",")}\n  )`;t.fillStyle=i,e.lineWidth?(t.strokeStyle=s,t.lineWidth=e.lineWidth):t.strokeStyle="rgba(0,0,0,0)"})(t,{fillStyle:e.fillStyle,strokeStyle:e.strokeStyle,lineWidth:e.lineWidth}),e.beforeDraw&&e.beforeDraw(t),e.draw(t),null===(i=e.afterDraw)||void 0===i||i.call(e,t),t.restore()},c=(t,e)=>{if(!e.backgroundColor)return;const i=`rgba(${e.backgroundColor.join(",")})`;t.fillStyle=i,a(t,e)},g=document.createElement("canvas").getContext("2d"),u=(t,e,i,s)=>Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)),p=class extends s{constructor(t){super(),this.type="node",this.name="",this.id="",this.x=0,this.y=0,this.width=0,this.height=0,this.active=!1,this.translate=[0,0],this.scale=1,this.origin=[.5,.5],this.rotate=0,this.zIndex=0,this.visible=!0,this.enableDrag=!1,this.enableClick=!0,this.parent=null,this.children=[],this.points=[0,0,1,0,1,1,0,1],this.layout="LeftTop",this.drawPoints=[],this.fillStyle=[0,0,0,0],this.strokeStyle=[0,0,0,0],this.lineWidth=0,this.backgroundColor=null,this.skew=[0,0],this.flip=!1,this.matrix=null,this.extra={},this.opacity=1;for(const e in t)this[e]=t[e]}appendNode(t){if(t instanceof Array)t.forEach((t=>{this.appendNode(t)}));else{if(this.children.includes(t))return;this.children.push(t),t.parent=this}}removeNode(t){this.children.forEach(((e,i)=>{e===t&&this.children.splice(i,1)}))}setSize(t){[this.width,this.height]=t}getSize(){return[this.width,this.height]}setTranslate(t){this.translate=t}getTranslate(){return this.translate}getPostion(){return[this.x,this.y]}setPostion(t){[this.x,this.y]=t}setRotate(t){return this.rotate=t,this}getParams(){const t={};return Object.getOwnPropertyNames(this).forEach((e=>{["parent","children"].includes(e)||(t[e]=n(this[e]))})),t}clone(){return this.getParams()}beforeLayout(){}afterLayout(){}beforeDraw(t){return t}isBoundingBox(t){const e=((t,e)=>{if(!g)return!1;g.beginPath(),g.moveTo(e[0],e[1]);for(let t=2;t<e.length;t+=2)g.lineTo(e[t],e[t+1]);return g.closePath(),!!g.isPointInPath(t[0],t[1])})(t,this.drawPoints);return e}getNodeByPoint(t){const e=[],i=s=>{s.enableClick&&s.isBoundingBox(t)&&e.push(s),s.children.length>0&&s.children.forEach((t=>{i(t)}))};return i(this),e}draw(t){t.save(),t.globalAlpha=this.opacity,((t,e)=>{e.drawPoints.length<4||a(t,e)})(t,this),t.restore()}afterDraw(t){return t}};function f(t,e){return[t.a*e[0]+t.c*e[1]+t.e,t.b*e[0]+t.d*e[1]+t.f]}function w(t,e){let i=[];for(let s=0;s<e.length;s+=2)i=i.concat(f(t,[e[s],e[s+1]]));return i}function m(t){return void 0===t}function v(t,e=0){return{a:1,c:0,e:t,b:0,d:1,f:e}}function b(...t){const e=(t,e)=>({a:t.a*e.a+t.c*e.b,c:t.a*e.c+t.c*e.d,e:t.a*e.e+t.c*e.f+t.e,b:t.b*e.a+t.d*e.b,d:t.b*e.c+t.d*e.d,f:t.b*e.e+t.d*e.f+t.f});switch((t=Array.isArray(t[0])?t[0]:t).length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{const[i,s,...n]=t;return b(e(i,s),...n)}}}function x(...t){return b(...t)}const{cos:P,sin:y,PI:A}=Math;function B(t,e,i){const s=P(t),n=y(t),o={a:s,c:-n,e:0,b:n,d:s,f:0};return m(e)||m(i)?o:b([v(e,i),o,v(-e,-i)])}function S(t,e=undefined,i=undefined,s=undefined){m(e)&&(e=t);const n={a:t,c:0,e:0,b:0,d:e,f:0};return m(i)||m(s)?n:b([v(i,s),n,v(-i,-s)])}const{tan:C}=Math;function M(t,e){return{a:1,c:C(t),e:0,b:C(e),d:1,f:0}}class E extends p{constructor(t){super(t),this.width=400,this.height=400;const e=Object.assign({canvas:document.createElement("canvas"),wrapper:document.createElement("div")},t);for(const t in e)this[t]=e[t];this.ctx=this.canvas.getContext("2d"),this.ctx.font="20px sans-serif",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.setAttribute("contenteditable","contenteditable")}setSize(t){[this.width,this.height]=t,[this.canvas.width,this.canvas.height]=t}screenCoordToLogicPoint(t,e){if(e)return t=w(function(t){const{a:e,b:i,c:s,d:n,e:o,f:r}=t,h=e*n-i*s;return{a:n/h,b:i/-h,c:s/-h,d:e/h,e:(n*o-s*r)/-h,f:(i*o-e*r)/h}}(e),[t[0]*E.devicePixelRatio,t[1]*E.devicePixelRatio]),t;console.error("缺少matrix")}}E.devicePixelRatio=window.devicePixelRatio;const k=E,L={leftTop:(t,e)=>[-e.origin[0]*e.width,-e.origin[1]*e.height],rightTop:(t,e)=>[t.width-e.origin[0]*e.width,-e.origin[1]*e.height],rightBottom:(t,e)=>[t.width-e.origin[0]*e.width,t.height-e.origin[1]*e.height],leftBottom:(t,e)=>[-e.origin[0]*e.width,t.height-e.origin[1]*e.height],center:(t,e)=>[t.width/2-e.origin[0]*e.width,t.height/2-e.origin[1]*e.height],leftCenter:(t,e)=>[-e.origin[0]*e.width,t.height/2-e.origin[1]*e.height],rightCenter:(t,e)=>[t.width-e.origin[0]*e.width,t.height/2-e.origin[1]*e.height]},D=class extends p{constructor(t){super(t),this.src="",this.img=new Image,this.repeat=!1,this.flip=!1,this.type="image",this.name="imageName";for(const e in t)this[e]=t[e];this.img.crossOrigin="anonymous",this.init()}updateSrc(t,e){if(t instanceof Image){const[e,i]=this.getSize();return this.img=t,this.setSize([e,i]),this.trigger("onload"),t}return h(t,(t=>{if(null===t)return;this.img=t;const[i,s]=this.getSize();i||s||this.setSize([t.width,t.height]),this.trigger("onload"),e&&e()}))}init(){this.src&&h(this.src,(t=>{if(null===t)return;this.img=t;const[e,i]=this.getSize();e||i||this.setSize([t.width,t.height]),this.trigger("onload")}))}draw(t){this.img&&(()=>{const e=u(this.drawPoints[0],this.drawPoints[1],this.drawPoints[2],this.drawPoints[3]),i=u(this.drawPoints[2],this.drawPoints[3],this.drawPoints[4],this.drawPoints[5]);if(t.save(),t.globalAlpha=this.opacity,this.flip||t.translate(this.drawPoints[0],this.drawPoints[1]),this.flip&&(t.translate(this.drawPoints[0]+e,this.drawPoints[1]),t.scale(-1,1)),t.rotate((t=>{const e=(t[3]-t[1])/(t[2]-t[0]);let i=180*Math.atan(e)/Math.PI;return t[0]>t[2]&&(i+=180),i*Math.PI/180})(this.drawPoints)),(this.skew[0]||this.skew[1])&&t.transform(1,this.skew[0],this.skew[1],1,0,0),this.repeat){const s=t.createPattern(this.img,"repeat");if(!s)return;t.fillStyle=s,t.fillRect(0,0,e,i)}else t.drawImage(this.img,0,0,e,i);t.restore()})()}},N=document.createElement("div");N.style.cssText="\n  left:10px;\n  top:10px;\n  color:white;\n  background:rgba(255,255,255,.4);\n  position: absolute;\n",document.body.appendChild(N);const I={Mobile:{tapstart:"touchstart",tapmove:"touchmove",tapend:"touchend",getPosition:t=>[t.touches[0].clientX,t.touches[0].clientY]},PC:{tapstart:"mousedown",tapmove:"mousemove",tapend:"mouseup",getPosition:t=>[t.clientX,t.clientY]}},z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"Mobile":"PC";let j=!1,O=!1;i(640);const T=class extends p{constructor(t){super(t),this.step=100,this.fontColor=[255,255,255,.3],this.lineColor=[255,255,255,.1],this.pointYNums=0;const e=Object.assign({name:"coordinate",type:"other",points:[0,0,.4,.6,1,1],enableClick:!1},t);for(const t in e)this[t]=e[t]}beforeLayout(){this.setSize(this.parent.getSize());let t=[];const[e,i]=this.getSize(),[s]=this.parent.getSize(),n=Math.max(Math.round(1/this.parent.scale),1);this.step=100*n;const{step:o}=this;for(let e=0;e<=o;e+=o)t=t.concat([0,e/i,1,e/i]);this.pointYNums=t.length;for(let i=0;i<=o;i+=o)t=t.concat([i/e,0,i/s,1]);this.points=t}draw(t){t.strokeStyle=o(this.lineColor),t.lineWidth=1,t.lineCap="round";const e=this.drawPoints[5]-this.drawPoints[1],i=Math.ceil(this.parent.parent.width/e),s=Math.ceil(this.parent.parent.height/e),n=this.drawPoints[1]%e,r=Math.floor(this.drawPoints[1]/e),h=this.drawPoints[0]%e,a=Math.floor(this.drawPoints[0]/e);for(let i=0;i<s;i+=1)t.beginPath(),t.moveTo(0,e*i+n),t.lineTo(this.parent.parent.width,e*i+n),t.closePath(),t.stroke();for(let s=0;s<i;s+=1)t.beginPath(),t.moveTo(e*s+h,0),t.lineTo(e*s+h,this.parent.parent.height),t.closePath(),t.stroke();t.save(),t.font="20px sans-serif",t.fillStyle=o(this.fontColor),t.textAlign="left";for(let i=0;i<=s;i+=1)t.fillText((this.step*(i-r)).toString(),4,20+e*i+n);for(let s=0;s<=i;s+=1)t.fillText((this.step*(s-a)).toString(),4+e*s+h,20);t.restore()}},R=class extends p{constructor(t){super(t),this.src=t.src,this.enableDrag=!0,this.init()}init(){const{body:t}=document;this.iframeWin=document.createElement("iframe"),this.iframeWin.setAttribute("src",this.src),this.iframeWin.style.cssText="\n      position:fixed;\n      left:0;\n      top:0;\n      border:0;\n      transform-origin:left top;\n      opacity:1\n    ",this.iframeWin.style.pointerEvents="none",this.iframeWin.style.width=this.width/k.devicePixelRatio+"px",this.iframeWin.style.height=this.height/k.devicePixelRatio+"px",this.iframeWin.setAttribute("scrolling","no"),t.appendChild(this.iframeWin),document.body.addEventListener("mousedown",(()=>{this.iframeWin.style.pointerEvents="none"})),document.body.addEventListener("dblclick",(()=>{this.iframeWin.style.pointerEvents="inherit"}))}afterLayout(){this.iframeWin.style.transform=`\n      translate3D(\n        ${this.drawPoints[0]/k.devicePixelRatio}px, \n        ${this.drawPoints[1]/k.devicePixelRatio}px,\n        0\n      )\n      scale(${this.matrix.a}, ${this.matrix.a})\n    `,this.iframeWin.style.opacity=this.opacity.toString()}};new class extends p{constructor(){super(),this.backgroundColor=[30,200,200,.1],this.lineWidth=4,this.strokeStyle=[255,255,255,1],this.deleteBtn=new D,this.initFlipBtn(),this.initDeleteBtn(),this.enableClick=!1}bindParent(t){this.parent&&this.parent!==t&&this.unBindParent(),this.parent=t,this.setSize(t.getSize()),this.parent.appendNode(this),this.parent.extra.autoFlip?(this.flipBtn.visible=!1,this.flipBtn.enableClick=!1):(this.flipBtn.visible=!0,this.flipBtn.enableClick=!0)}unBindParent(){this.parent&&this.parent.removeNode(this)}initFlipBtn(){this.flipBtn=new D({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAMAAAAPdrEwAAAAdVBMVEUAAAD///////////////////////////////////////////////////////////////////////////8AAABfX1/f39+/v78gICCAgIBwcHBAQEDv7++QkJCvr68QEBDPz89QUFCgoKB/f39PT08wMDBvb29DwE22AAAAE3RSTlMA798gkL+AQDAQcGCgz1CvzrCe0xQd8gAAAtdJREFUWMO1meuSmzAMRrG5hASSbCuDIVxC0m7f/xGbbJPRbGNJDpjznzOaD9kyJvIhL5JyrxXcUDo9Zoc8CsEmSxW8kiabhd5EAYkuZ9u3mQIBXcTBxUgZBxcjyVvyHSGmYvEWxym8SRqHLhlRO5+UE5hFIoexh5noWDBrgHXcOWeW3TljVrAIlYdPAzMRzOHdGgKw3zrMRD8H6O8dBGL3ErQKpVb/x51CMNLv5gJk6hu+kfj3nR0ujfni3LVWjGTr3x2V+UZTCdVnaI6BZTQvdLVn2SWvHowDtvIMi+axxkUzymXL7XEyTlq5bA0S16oapnsCk207H7d6nL7gPWpsmBNQbIiXKMvFupPZm6ltHm7LJbKBOdTP1dkziSTEOvF0V0yPpO4nTeXptvT+R7Qb1iOspI4MOwcnjZHdJ7bsPDqAiwlzpOnPXHMXUUbuSLK7/dckVGcfwcVv4+PuuURKokE+jZe7YxLZE2vRGC93y/SIjpS7q33c/VSZOw3RfUCoeXc93gfxE3DCqNEtzYZ6lpp4T9VsNeAEvLSj68nKQ62odX6jsj1QVJJaRZpZMq3nuYdovj2z83Tg5f4kdtWS2zB7L/cFXPyghswZExHdAzFmCm4vPvc+7glcHKhRYLGjJXdDjYJIcZuasbL7Ck5w7BJlN7Xorsmxm7E5yu6RPj5tuMknu9lDnxKO1Y2dYdb8h8wv8gtAphQOwSfmw0jOAxMh6n7StXb6GlpD9efqlwf2COsmZgNF8VBvFdNajdNtBXUcYdncF4CDQXyJWDYn717Vo1i0UDZW3hhixlMrUSwbsW13fg7iQUhax+QdztJri2LNq5b1L4jCX2utfxmHbPchzHr1i8/1r2vDXzKvfzUe/kI/vPuDMC/v72S72i+f1X9UyRQ6dMlInPiLM0zZU16GF6O80MHFyKbUjHf5T+nUpU0z9C4hP2TH9PmL/uNnUuSRB38BJ4/actlilNIAAAAASUVORK5CYII="}),this.flipBtn.zIndex=1e4,this.flipBtn.name="flipBtn",this.flipBtn.setSize([58,58]),this.origin=[.5,.5],this.flipBtn.layout="leftBottom",this.appendNode(this.flipBtn),this.flipBtn.enableDrag=!1,this.flipBtn.register("tapstart",(()=>{this.trigger("flip",this.parent)}))}initDeleteBtn(){this.deleteBtn=new D({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAABaCAMAAADgtNoOAAAAV1BMVEUAAAD///////////////////////////////////////////////////////////////////////8AAABgYGBfX1/f39/Pz8+goKCAgIBQUFBAQEAQEBBXaUEUAAAAEnRSTlMA798gv4CQQBAwoHBgz4+vX1BxguXuAAACR0lEQVRo3sXZ2Y7CMAwF0GZpoBsMbsr+/985vKCrUdI6ZhxxX5GOLNckbdKUpBtDP1lDrxjrj+2pa1Sya72hND7s/gsHuEls/zm/bwGv8T9OX0Z6py8jB5k+FMnoTLnsPAnjnXrRiBmKOn2gj3LgaTfRh7GOoy1RJbxjaAbvtmhD/4rp+IbotwW0Pm5JIdM+RydzrTfnIyllSJtttGyTtNyTWrx+R5BBffwQ82dWWlJN2yCOEO3Ce1JOW6VsFI4hqVW41bfN+8WM1nOJjytlc7vHM61nxz7J83Oe50iZxNcPzwutJrAtWeY5j0f8kI9hW3KfYaT0/OCaEmg9txl4Ss9XblI8bWQBntILuxoSyXDQ7N+nIwHO00jXNCcS4AKaRiyvBXghjQk/kgAX0NRjTIpwAU1T0UIFXECTbRpDYnwpXQqJJDhoPrBZHLS6Hd921LZBA+dtI6SB88/SCmng/AxOAnpZBLjHbllCEwnwI7adIroIx1o1CmgRfsLeUECX4tiMjYCW4NiLeVqIe+69/go6h99oPYF793mAzuF3pt2bDY+gc3jc/FcyL1aXJ+gUf543d0uuKeflvtLU6yNemJagKaqx+AJUz8/b3usX7ip8uuJJVivc1fvmDpBFhcsPrQbVIal6NlP/TEm/K7nT6qA+I8h+0qDtJ2emXz+QBV3/jFr/bF3Ulq9fOEwJrTbnYV/v7uj7d16vjFa9aMSFcrlFp0v1voIMfbT6MrLr7QascNXtc65vX7BGulN79O+7/6kPY9nd/y9vIL4Rt3sqFQAAAABJRU5ErkJggg=="}),this.deleteBtn.name="deleteBtn",this.deleteBtn.zIndex=1e4,this.deleteBtn.setSize([58,58]),this.deleteBtn.zIndex=1e3,this.origin=[.5,.5],this.deleteBtn.layout="rightTop",this.deleteBtn.enableDrag=!1,this.appendNode(this.deleteBtn),this.deleteBtn.register("tapstart",(()=>{this.trigger("delete",this.parent)}))}};class W extends s{constructor(t){super(),this.name="func",this.stage=null,this.render=null,this.rootNode=null;for(const e in t)this[e]=t[e]}}const F=document.getElementById("stageWrap"),{clientWidth:U,clientHeight:X}=F,Q=new k({backgroundColor:[0,0,3,1]});Q.setSize([U*k.devicePixelRatio,X*k.devicePixelRatio]),F.appendChild(Q.canvas);const V=new class{constructor(t){this.rQA=0,this.ctx=null==t?void 0:t.ctx,this.node=null==t?void 0:t.node}drawFrame(t){this.rQA||(this.rQA=requestAnimationFrame((()=>{this.layout(),this.render(),this.rQA=0,t&&t()})))}layout(){this.node&&(t=>{const e=(i,s,n)=>{let o=s||t;i.beforeLayout&&i.beforeLayout(),o!==i&&L[i.layout]&&i.setPostion(L[i.layout](o,i));const r=(t=>x(v(t.x+t.translate[0],t.y+t.translate[1]),S(t.scale,t.scale,t.origin[0]*t.width,t.origin[1]*t.height),M(t.skew[0],t.skew[1]),B(Math.PI/180*t.rotate,t.origin[0]*t.width,t.origin[1]*t.height)))(i);n=n?x(n,r):r,i.matrix=n,i.drawPoints=w(n,i.points.map(((t,e)=>e%2==0?t*i.width:t*i.height))),i.afterLayout&&i.afterLayout(),i.children.length>0&&(o=i,i.children.forEach((t=>{e(t,o,n)})))};e(t)})(this.node)}render(){this.ctx&&this.node&&(this.ctx.clearRect(0,0,this.node.width,this.node.height),d(this.ctx,this.node))}}({ctx:Q.ctx,node:Q}),J=new class extends p{constructor(t){super(),this.name="rootNode",this.enableDrag=!0,this.stage=t.stage,this.render=t.render,this.setSize([...this.stage.getSize()]),this.fillStyle=[0,0,0,.1],this.strokeStyle=[255,255,255,.08],this.lineWidth=1;const e=new T;this.appendNode(e),window.onresize=()=>{const{clientWidth:t,clientHeight:e}=this.stage.canvas;this.stage.setSize([t*k.devicePixelRatio,e*k.devicePixelRatio]),this.setSize([...this.stage.getSize()]),this.render.drawFrame()},this.render.drawFrame()}}({stage:Q,render:V});Q.appendNode(J);const H=new class extends s{constructor(t){super(),this.mouseMoveVec2=[0,0];for(const e in t)this[e]=t[e];this.selectedNode=this.node,this.addTouchOrMouseEventListener(),this.addShortcutEventListener(),this.addMousewheelListener()}touchOrMouseEvent(t){const{type:e}=t,i=I[z].getPosition(t);var s,n;this.latestClientPoint=((t,e)=>{const i=t.getBoundingClientRect();return[e[0]-i.x,e[1]-i.y]})(this.stage.canvas,i),this.latestLogicPoint=this.stage.screenCoordToLogicPoint(this.latestClientPoint,this.selectedNode.matrix),this.clientPoint&&(this.mouseMoveVec2=(s=this.stage.screenCoordToLogicPoint(this.clientPoint,this.selectedNode.matrix),[(n=this.stage.screenCoordToLogicPoint(this.latestClientPoint,this.selectedNode.matrix))[0]-s[0],n[1]-s[1]])),this.clientPoint=this.latestClientPoint,this.logicPoint=this.latestLogicPoint,this.canvasPoint=i.map((t=>t*k.devicePixelRatio)),e===I[z].tapstart&&(this.isMouseDown=!0,this.selectedNode=O?this.node:((t,e)=>{const i=((t,e)=>{const i=[],s=t=>{t.enableClick&&t.isBoundingBox(e)&&i.push(t),t.children.length>0&&t.children.forEach((t=>{s(t)}))};return s(t),i})(t,this.canvasPoint);if(0===i.length)return t;i.sort(((t,e)=>t.zIndex-e.zIndex));const s=i[i.length-1];if(s.parent)for(let t=0;t<s.parent.children.length;t++)if(s===s.parent.children[t]){s.parent.children.push(s.parent.children.splice(t,1)[0]);break}return s})(this.node),this.trigger("tapstart")),e===I[z].tapmove&&this.trigger("tapmove"),e===I[z].tapend&&(this.isMouseDown=!1,this.trigger("tapend")),this.render.drawFrame()}showDebuggerWhenMove(){this.node.matrix&&(N.innerHTML=`坐标:( ${this.logicPoint.map((t=>Math.round(t))).join(",")} ); Node:${this.selectedNode.name}`,N.style.transform=`translate3D(${this.clientPoint[0]}px, ${this.clientPoint[1]}px,0)`),j=!1}addTouchOrMouseEventListener(){const t=this.touchOrMouseEvent.bind(this);this.stage.canvas.addEventListener(I[z].tapstart,t),this.stage.canvas.addEventListener(I[z].tapmove,t),this.stage.canvas.addEventListener(I[z].tapend,t)}addMousewheelListener(){document.body.onmousewheel=t=>{if(this.clientPoint&&!1===j){const t=this.stage.screenCoordToLogicPoint(this.clientPoint,this.node.matrix),e=t[0]/this.node.width,i=t[1]/this.node.height,s=x(v(this.node.x+this.node.translate[0],this.node.y+this.node.translate[1]),S(this.node.scale,this.node.scale,e*this.node.width,i*this.node.height),M(this.node.skew[0],this.node.skew[1]),B(Math.PI/180*this.node.rotate,this.node.origin[0]*this.node.width,this.node.origin[1]*this.node.height));this.node.origin=[e,i],this.node.setPostion([this.node.x-(s.e-this.node.matrix.e),this.node.y-(s.f-this.node.matrix.f)]),j=!0}j&&(this.node.scale+=t.deltaY/8e3,this.node.scale=Math.max(Math.min(this.node.scale,100),.01),this.render.drawFrame())}}addShortcutEventListener(){document.addEventListener("keydown",(t=>{32===t.keyCode&&(O=!0),187===t.keyCode&&(this.selectedNode.opacity=Math.min(this.selectedNode.opacity+.1,1)),189===t.keyCode&&(this.selectedNode.opacity=Math.max(this.selectedNode.opacity-.1,0)),this.render.drawFrame()})),document.addEventListener("keyup",(t=>{32===t.keyCode&&(O=!1)}))}}({stage:Q,render:V,node:J});(t=>{t.register("tapmove",(()=>{t.showDebuggerWhenMove(),!1!==t.selectedNode.enableDrag&&(t.selectedNode===t.node&&(t.mouseMoveVec2=t.mouseMoveVec2.map((e=>e*t.node.scale))),t.isMouseDown&&t.selectedNode.setPostion([t.selectedNode.x+t.mouseMoveVec2[0],t.selectedNode.y+t.mouseMoveVec2[1]]))}))})(H);const Y=new URL(location.href).searchParams.get("iframe");if(Y){const t=new R({width:2800,height:16400,src:Y});J.appendNode(t)}new class extends W{constructor(t){super(t),this.newkey=null==t?void 0:t.newkey}init(){this.handleDragImages(),this.handlerPasteImages()}handleDragImages(){this.stage.canvas.addEventListener("dragenter",(t=>{t.stopPropagation(),t.preventDefault()}),!1),this.stage.canvas.addEventListener("dragover",(t=>{t.stopPropagation(),t.preventDefault()}),!1),this.stage.canvas.addEventListener("drop",(t=>{const{files:e}=t.dataTransfer;this.handleFiles(e),t.stopPropagation(),t.preventDefault()}),!1)}handlerPasteImages(){window.addEventListener("paste",(t=>{if(t.clipboardData&&t.clipboardData.items[0].type.indexOf("image")>-1){const{files:e}=t.clipboardData;this.handleFiles(e)}else t.clipboardData&&t.clipboardData.items[0].type.indexOf("text/plain")}),!1)}handleFiles(t){const e=new FileReader,i=s=>{if(s===t.length)return!1;const n=t[s];e.onload=t=>{const e=t.srcElement.result;this.receiveImg(e),i(++s)},e.readAsDataURL(n)};i(0)}receiveImg(t){const e=new D({enableDrag:!0});this.rootNode.appendNode(e),e.register("onload",(()=>{e.setPostion(L.center(e.parent,e)),function(t){let e=0,i=0;for(const s of t)e+=s.width*s.height,i=Math.max(i,s.width);t.sort(((t,e)=>e.height-t.height));const s=[{x:0,y:0,width:Math.max(Math.ceil(Math.sqrt(e/.95)),i),height:1/0}];let n=0,o=0;for(const e of t)for(let t=s.length-1;t>=0;t--){const i=s[t];if(!(e.width>i.width||e.height>i.height)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.height),n=Math.max(n,e.x+e.width),e.width===i.width&&e.height===i.height){const e=s.pop();t<s.length&&(s[t]=e)}else e.height===i.height?(i.x+=e.width,i.width-=e.width):e.width===i.width?(i.y+=e.height,i.height-=e.height):(s.push({x:i.x+e.width,y:i.y,width:i.width-e.width,height:e.height}),i.y+=e.height,i.height-=e.height);break}}}(this.rootNode.children.filter((t=>"image"===t.type))),this.render.drawFrame()})),e.updateSrc(t)}}({stage:Q,render:V,rootNode:J}).init()}},i={};function s(t){var n=i[t];if(void 0!==n)return n.exports;var o=i[t]={exports:{}};return e[t](o,o.exports,s),o.exports}s.m=e,t=[],s.O=(e,i,n,o)=>{if(!i){var r=1/0;for(l=0;l<t.length;l++){for(var[i,n,o]=t[l],h=!0,a=0;a<i.length;a++)(!1&o||r>=o)&&Object.keys(s.O).every((t=>s.O[t](i[a])))?i.splice(a--,1):(h=!1,o<r&&(r=o));if(h){t.splice(l--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,n,o]},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var n,o,[r,h,a]=i,d=0;if(r.some((e=>0!==t[e]))){for(n in h)s.o(h,n)&&(s.m[n]=h[n]);if(a)var l=a(s)}for(e&&e(i);d<r.length;d++)o=r[d],s.o(t,o)&&t[o]&&t[o][0](),t[r[d]]=0;return s.O(l)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var n=s.O(void 0,[640],(()=>s(329)));n=s.O(n)})();
//# sourceMappingURL=main.2c9656c3f08cef722603.js.map